# @TEST-DOC: Test various MetricsAddress settings in zeekctl.cfg
#
# @TEST-EXEC: bash %INPUT
#
# @TEST-EXEC: TEST_DIFF_CANONIFIER="$SCRIPTS"/diff-zeekctl-config btest-diff default
# @TEST-EXEC: TEST_DIFF_CANONIFIER="$SCRIPTS"/diff-zeekctl-config btest-diff custom
# @TEST-EXEC: TEST_DIFF_CANONIFIER="$SCRIPTS"/diff-zeekctl-config btest-diff empty

. zeekctl-test-setup

zeekctlconfig=$ZEEKCTL_INSTALL_PREFIX/spool/installed-scripts-do-not-touch/auto/zeekctl-config.zeek

# Plain - no UseWebSocket.
installfile etc/node.cfg__cluster
zeekctl install
tail -5 "$zeekctlconfig" > default

echo "MetricsAddress = 192.168.0.1" >> "$ZEEKCTL_INSTALL_PREFIX"/etc/zeekctl.cfg
zeekctl install
tail -5 "$zeekctlconfig" > custom

# Explicitly set the option to empty in order to skip the redef.
sed -i 's/MetricsAddress = .*/MetricsAddress = /g' "$ZEEKCTL_INSTALL_PREFIX"/etc/zeekctl.cfg
zeekctl install
tail -5 "$zeekctlconfig" > empty
